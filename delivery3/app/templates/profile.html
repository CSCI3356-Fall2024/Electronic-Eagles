{% extends "base.html" %}

{% block title %}
 Profile - {{ profile.username }}
{% endblock %}

{% block content %}
<div class="container mt-5">
 <div class="row justify-content-center">
     <div class="col-lg-8 col-md-10">
         <div class="card shadow">
             <div class="card-body p-4">
                 <h2 class="text-center mb-4">{{ profile.name }}'s Profile</h2>
                 
                 <div class="text-center mb-4">
                     <form id="profile-pic-form" method="POST" enctype="multipart/form-data">
                         {% csrf_token %}
                         {% if profile.profile_picture %}
                             <div style="width: 150px; height: 150px; display: inline-block; overflow: hidden; border-radius: 50%; border: 3px solid #fff; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                                 <img src="{{ profile.profile_picture.url }}" 
                                      alt="Profile Picture" 
                                      style="width: 100%; height: 100%; object-fit: cover;">
                             </div>
                         {% else %}
                             <p>No profile picture uploaded</p>
                         {% endif %}
                         <input type="file" name="profile_picture" id="profile-pic-upload" style="display:none;" accept="image/*">
                         <br>
                         <button type="button" onclick="document.getElementById('profile-pic-upload').click();" class="btn btn-secondary mt-2">
                             Change Picture
                         </button>
                     </form>
                 </div>
                 
                 <!-- Profile Details -->
                 <form id="profile-edit-form" method="POST">
                     {% csrf_token %}
                     <table class="table table-bordered">
                         <tbody>
                             <tr>
                                 <th>Username</th>
                                 <td>{{ profile.username }}</td>
                             </tr>
                             {% for field in profile_fields %}
                             <tr class="editable-row">
                                 <th>{{ field.label }}</th>
                                 <td>
                                     <span class="display-value">{{ field.value }}</span>
                                     <input type="text" name="{{ field.name }}" value="{{ field.value }}" class="form-control edit-input" style="display:none;">
                                     <button type="button" class="btn btn-sm btn-outline-secondary edit-btn edit-toggle ml-2">
                                         <i class="fas fa-edit"></i>
                                     </button>
                                 </td>
                             </tr>
                             {% endfor %}
                         </tbody>
                     </table>
                     <div id="edit-controls" style="display:none;" class="text-center">
                         <button type="submit" class="btn btn-primary">Save Changes</button>
                         <button type="button" class="btn btn-secondary cancel-edit ml-2">Cancel</button>
                     </div>
                 </form>
             </div>
         </div>
     </div>
 </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
 const editButtons = document.querySelectorAll('.edit-toggle');
 const editControls = document.getElementById('edit-controls');
 const cancelButton = document.querySelector('.cancel-edit');
 const profilePicUpload = document.getElementById('profile-pic-upload');

 editButtons.forEach(button => {
     button.addEventListener('click', function() {
         const row = this.closest('.editable-row');
         const displayValue = row.querySelector('.display-value');
         const editInput = row.querySelector('.edit-input');
         
         displayValue.style.display = 'none';
         editInput.style.display = 'inline-block';
         this.style.display = 'none';
         
         editControls.style.display = 'block';
         row.classList.add('editing-mode');
     });
 });

 cancelButton.addEventListener('click', function() {
     document.querySelectorAll('.editable-row').forEach(row => {
         const displayValue = row.querySelector('.display-value');
         const editInput = row.querySelector('.edit-input');
         const editButton = row.querySelector('.edit-btn');
         
         editInput.value = displayValue.textContent;
         displayValue.style.display = 'inline-block';
         editInput.style.display = 'none';
         editButton.style.display = 'inline-block';
         
         row.classList.remove('editing-mode');
     });
     
     editControls.style.display = 'none';
 });

 // Profile picture change
 profilePicUpload.addEventListener('change', function() {
     document.getElementById('profile-pic-form').submit();
 });
});
</script>
{% endblock %}
